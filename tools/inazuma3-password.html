<!DOCTYPE html>
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<title>イナズマ3 パスワード</title>
<script type="text/javascript">
var CHARA_DATA = [
	[21, "源田　幸次郎", "げんおう"],
	[22, "大野　伝助", "だいでん"],
	[23, "万丈　一道", "ばんじょう"],
	[24, "成神　健也", "なるかみ"],
	[25, "五条　勝", "ごじょう"],
	[26, "辺見　渡", "へんみ"],
	[27, "咲山　修二", "さきやま"],
	[28, "洞面　秀一郎", "どうめん"],
	[29, "寺門　大貴", "じもん"],
	[32, "兵藤　雄平", "ひょうどう"],
	[33, "恵那　和樹", "えな"],
	[34, "椋本　圭", "むくもと"],
	[35, "渋木　翔大", "しぶき"],
	[36, "大楠　星士", "おおくす"],
	[41, "鉈　十三", "じゅうぞう"],
	[42, "三途　渡", "さんず"],
	[43, "柳田　しげる", "やなぎだ"],
	[44, "不乱　拳", "フランケン"],
	[45, "屍　藤美", "ふじみ"],
	[46, "霊幻　道久", "れいげん"],
	[47, "木乃伊　魔美", "ミイラ"],
	[48, "八墓　祟", "やつはか"],
	[49, "幽谷　博之", "ゆうこく"],
	[50, "月村　憲一", "つきむら"],
	[51, "武羅渡　牙", "ブラッド"],
	[52, "不死　祀", "ふし"],
	[53, "人形　幻", "にんぎょう"],
	[54, "円谷　未知", "つぶらや"],
	[55, "黒上　呪", "くろがみ"],
	[56, "魔界　崇雄", "まかい"],
	[61, "猪口　兵吾", "イノシシ"],
	[62, "鶏井　亮太", "ニワトリ"],
	[63, "魚住　拓人", "サカナ"],
	[64, "蛙田　達士", "カエル"],
	[65, "獅子王　吼", "ライオン"],
	[66, "香芽　レオン", "カメレオン"],
	[67, "大鷲　誠次", "ワシ"],
	[68, "猿田　登", "サル"],
	[69, "五利　真吾", "ゴリラ"],
	[70, "蛇丸　彰真", "ヘビ"],
	[71, "水前寺　馳威太", "チーター"],
	[72, "小荒　登", "コアラ"],
	[73, "判　竹夫", "パンダ"],
	[74, "荒井川　熊巳", "アライグマ"],
	[75, "根津　光夫", "ネズミ"],
	[76, "牛尾　空也", "ウシ"],
	[81, "杉森　威", "たけし"],
	[82, "弘山　誘", "ゆう"],
	[83, "花岡　強", "つよし"],
	[84, "室伏　恐", "きょう"],
	[85, "稲田　則", "のり"],
	[86, "寺川　巌", "いわお"],
	[87, "藤丸　啓", "けい"],
	[88, "山郷　暴", "ばく"],
	[89, "山岸　迫", "せり"],
	[90, "大部　信", "しん"],
	[91, "下鶴　改", "あらた"],
	[92, "真下　乏", "ましも"],
	[93, "都築　静", "つづき"],
	[94, "平生　仁", "ひらお"],
	[95, "長友　喪", "ながとも"],
	[96, "水淵　無", "みずぶち"],
	[101, "相戸留　捜", "アイドル"],
	[102, "線路　鉄雄", "てっちゃん"],
	[103, "野部流　来人", "ノベル"],
	[104, "無敵　英雄", "ヒーロー"],
	[105, "仮沢　装", "コスプレ"],
	[106, "御良　一輝", "オンライン"],
	[107, "自作　派流", "じさくは"],
	[108, "呂簿　合機", "ロボ"],
	[109, "芸夢　好武", "ゲームき"],
	[110, "漫画　萌", "まんがか"],
	[111, "明井戸　達人", "アーケード"],
	[112, "木内　努", "きうち"],
	[113, "造形　製雄", "フィギュア"],
	[114, "闘馬　草太", "とうま"],
	[115, "声模　索太", "せいゆう"],
	[116, "熱斗　探李", "ネット"],
	[121, "百地　三太", "ももち"],
	[122, "藤林　長門", "ふじばやし"],
	[123, "高坂　仁", "こうさか"],
	[124, "児雷也　蟇助", "じらいや"],
	[125, "石川　五衛太", "ゴエモン"],
	[126, "風魔　小平太", "ふうま"],
	[127, "甲賀　幻", "こうが"],
	[128, "猿飛　佐之助", "さるとび"],
	[129, "柳生　十郎", "やぎゅう"],
	[130, "初鳥　伴三", "はつとり"],
	[131, "霧隠　才次", "きりがくれ"],
	[132, "鉢屋　也三郎", "はちや"],
	[133, "加藤　段", "かとう"],
	[134, "出浦　清盛", "いでうら"],
	[135, "滝川　一馬", "たきがわ"],
	[136, "城戸　弥門", "きど"],
	[141, "綾野　勇一", "あやの"],
	[142, "炭野　詠輔", "すみの"],
	[143, "芹沢　和憲", "せりざわ"],
	[144, "牧谷　寛", "まきや"],
	[145, "塩谷　ヒロ", "しおたに"],
	[146, "山根　羊", "やまね"],
	[147, "育井　庄児", "いくい"],
	[148, "大鯉　昇", "おおごい"],
	[149, "原野　徹", "はらの"],
	[150, "根上　大地", "だいち"],
	[151, "田主丸　茂樹", "たぬしまる"],
	[152, "草生　久志", "くさお"],
	[153, "米山　植人", "よねやま"],
	[154, "犬飼　茂樹", "いぬかい"],
	[155, "福井　咲平", "ふくい"],
	[156, "富士　地洋", "ふじ"],
	[161, "軟山　弱", "なんざん"],
	[162, "西垣　守", "にしがき"],
	[163, "女川　映日", "めがわ"],
	[164, "光宗　団", "みつむね"],
	[165, "黒部　立樹", "くろべ"],
	[166, "跳山　段", "とびやま"],
	[167, "屋形　直人", "やかた"],
	[168, "茂木　沙樹都", "もぎ"],
	[169, "武方　勝", "まさる"],
	[170, "武方　友", "とも"],
	[171, "武方　努", "つとむ"],
	[172, "段堂　正憲", "だんどう"],
	[173, "深沢　念司", "ふかざわ"],
	[174, "守野　優一", "まもりの"],
	[175, "中井　陽介", "なかい"],
	[176, "石井　清気", "いしい"],
	[181, "歩星　呑一", "ポセイドン"],
	[182, "阿保露　光", "アポロン"],
	[183, "部灰　炎", "ヘパイス"],
	[184, "荒須　乱", "アレス"],
	[185, "手魚　激", "ディオ"],
	[186, "在手　実弓", "アルテミス"],
	[187, "経目　須商", "ヘルメス"],
	[188, "明天名　智", "アテナ"],
	[189, "出右手　豊", "デメテル"],
	[190, "亜風炉　照美", "アフロディ"],
	[191, "平良　貞", "ヘラ"],
	[192, "位家　路主", "イカロス"],
	[193, "安芸　玲須", "アキレス"],
	[194, "経洛　玲州", "ヘラクレス"],
	[195, "黒野　時夫", "クロノス"],
	[196, "目戸　宇左", "メドゥーサ"],
	[201, "宗像　大翔", "ひろと"],
	[202, "英山　海人", "かいと"],
	[203, "北垣　亮太", "りょうた"],
	[204, "瀬島　樹", "いつき"],
	[205, "新竹　颯太", "そうた"],
	[206, "池尻　陽", "はる"],
	[207, "寺坂　響", "てらさか"],
	[208, "興津　蒼空", "そら"],
	[209, "間　竜介", "りゅうすけ"],
	[210, "森元　陸斗", "りくと"],
	[211, "如月　まこ", "まこ"],
	[212, "青島　薫", "あおしま"],
	[213, "甘井　一哉", "あまい"],
	[214, "平田　兼", "ひらた"],
	[215, "長谷部　精児", "はせべ"],
	[216, "巨島　祐一", "おおしま"],
	[221, "生垣　冗", "じょう"],
	[222, "姫島　極", "ひめじま"],
	[223, "菊池　康志", "きくち"],
	[224, "野馬　運", "のま"],
	[225, "向山　恭吾", "むかいやま"],
	[226, "茶木　椎斗", "ちゃき"],
	[227, "加納　輪介", "かのう"],
	[228, "立野　誠一", "たちの"],
	[229, "出前　洋", "でまえ"],
	[230, "安永　英嗣", "やすなが"],
	[231, "水口　精司", "みずぐち"],
	[232, "堤　広司", "つつみ"],
	[233, "友岡　愛斗", "ともおか"],
	[234, "丸出　為夫", "まるで"],
	[235, "石崎　満", "いしざき"],
	[236, "小塚　勇介", "こづか"],
	[241, "八百野　スミ子", "やおの"],
	[242, "筆山　トメ", "トメ"],
	[243, "大玉　好美", "おおたま"],
	[244, "骨盤　整", "こつばん"],
	[245, "執刀　直", "しっとう"],
	[246, "立見　律子", "りつこ"],
	[247, "店街　隠典", "ごいんきょ"],
	[248, "歌川　誠", "うたがわ"],
	[249, "如月　沙理奈", "サリー"],
	[250, "三河屋　三郎", "サブちゃん"],
	[251, "符呂暮　岩生", "プログレ"],
	[252, "家守　優司", "いえもり"],
	[253, "戎　正義", "えびす"],
	[254, "生地　釜雄", "いくじ"],
	[255, "衛士　展也", "えじ"],
	[256, "田辺　さやか", "さやか"]
];

var CHAR_TABLE = "あいうえおかきくけこさしすせそたちつてとなにぬねのはひふほまみむめもやゆよらりるれろわをんがぎぐげござじずぜぞだぢづでどばびぶぼぱぴぷぽアイウエオカキクケコサシスセソタチツテトナニヌネノハヒフホマミムメモヤユヨラリルレロワヲンガギグゲゴザジズゼゾダヂヅデドバビブボパピプポ";
var CHARS_MAP = gen_chars_map(CHAR_TABLE);

var SJIS_MAP = {
	"．": 0x8144, "？": 0x8148, "！": 0x8149, "ー": 0x815b, "…": 0x8163, "あ": 0x82a0, "ぃ": 0x82a1, "い": 0x82a2,
	"ぅ": 0x82a3, "う": 0x82a4, "ぇ": 0x82a5, "え": 0x82a6, "ぉ": 0x82a7, "お": 0x82a8, "か": 0x82a9, "が": 0x82aa,
	"き": 0x82ab, "ぎ": 0x82ac, "く": 0x82ad, "ぐ": 0x82ae, "け": 0x82af, "げ": 0x82b0, "こ": 0x82b1, "ご": 0x82b2,
	"さ": 0x82b3, "ざ": 0x82b4, "し": 0x82b5, "じ": 0x82b6, "す": 0x82b7, "ず": 0x82b8, "せ": 0x82b9, "ぜ": 0x82ba,
	"そ": 0x82bb, "ぞ": 0x82bc, "た": 0x82bd, "だ": 0x82be, "ち": 0x82bf, "ぢ": 0x82c0, "っ": 0x82c1, "つ": 0x82c2,
	"づ": 0x82c3, "て": 0x82c4, "で": 0x82c5, "と": 0x82c6, "ど": 0x82c7, "な": 0x82c8, "に": 0x82c9, "ぬ": 0x82ca,
	"ね": 0x82cb, "の": 0x82cc, "は": 0x82cd, "ば": 0x82ce, "ぱ": 0x82cf, "ひ": 0x82d0, "び": 0x82d1, "ぴ": 0x82d2,
	"ふ": 0x82d3, "ぶ": 0x82d4, "ぷ": 0x82d5, "へ": 0x82d6, "べ": 0x82d7, "ぺ": 0x82d8, "ほ": 0x82d9, "ぼ": 0x82da,
	"ぽ": 0x82db, "ま": 0x82dc, "み": 0x82dd, "む": 0x82de, "め": 0x82df, "も": 0x82e0, "ゃ": 0x82e1, "や": 0x82e2,
	"ゅ": 0x82e3, "ゆ": 0x82e4, "ょ": 0x82e5, "よ": 0x82e6, "ら": 0x82e7, "り": 0x82e8, "る": 0x82e9, "れ": 0x82ea,
	"ろ": 0x82eb, "わ": 0x82ed, "を": 0x82f0, "ん": 0x82f1, "ア": 0x8341, "ィ": 0x8342, "イ": 0x8343, "ゥ": 0x8344,
	"ウ": 0x8345, "ェ": 0x8346, "エ": 0x8347, "ォ": 0x8348, "オ": 0x8349, "カ": 0x834a, "ガ": 0x834b, "キ": 0x834c,
	"ギ": 0x834d, "ク": 0x834e, "グ": 0x834f, "ケ": 0x8350, "ゲ": 0x8351, "コ": 0x8352, "ゴ": 0x8353, "サ": 0x8354,
	"ザ": 0x8355, "シ": 0x8356, "ジ": 0x8357, "ス": 0x8358, "ズ": 0x8359, "セ": 0x835a, "ゼ": 0x835b, "ソ": 0x835c,
	"ゾ": 0x835d, "タ": 0x835e, "ダ": 0x835f, "チ": 0x8360, "ヂ": 0x8361, "ッ": 0x8362, "ツ": 0x8363, "ヅ": 0x8364,
	"テ": 0x8365, "デ": 0x8366, "ト": 0x8367, "ド": 0x8368, "ナ": 0x8369, "ニ": 0x836a, "ヌ": 0x836b, "ネ": 0x836c,
	"ノ": 0x836d, "ハ": 0x836e, "バ": 0x836f, "パ": 0x8370, "ヒ": 0x8371, "ビ": 0x8372, "ピ": 0x8373, "フ": 0x8374,
	"ブ": 0x8375, "プ": 0x8376, "ヘ": 0x8377, "ベ": 0x8378, "ペ": 0x8379, "ホ": 0x837a, "ボ": 0x837b, "ポ": 0x837c,
	"マ": 0x837d, "ミ": 0x837e, "ム": 0x8380, "メ": 0x8381, "モ": 0x8382, "ャ": 0x8383, "ヤ": 0x8384, "ュ": 0x8385,
	"ユ": 0x8386, "ョ": 0x8387, "ヨ": 0x8388, "ラ": 0x8389, "リ": 0x838a, "ル": 0x838b, "レ": 0x838c, "ロ": 0x838d,
	"ワ": 0x838f, "ヲ": 0x8392, "ン": 0x8393
};

var addEvent =
 window.addEventListener ? function(e, n, f) { e.addEventListener(n, f, false); }
                         : function(e, n, f) { e.attachEvent("on" + n, f); };

addEvent(window, "load", function() {
	addEvent(document.forms.f, "submit", on_submit);
});

function on_submit(ev) {
	var form = ev.target || ev.srcElement;
	var player_name = form.player_name.value;
	if (!verify_player_name(player_name)) {
		alert("プレイヤー名が不正です");
		return;
	}
	build_result(player_name);
}

function build_result(player_name) {
	var buf = "";
	buf += "<table>";
	var gen = new PasswordGenerator(player_name);
	for (var i = 0; i < CHARA_DATA.length; i ++) {
		var data = CHARA_DATA[i];
		var id = data[0], name = data[1], nick = data[2];
		var password = gen.generate(id);
		buf += "<tr><th>"+name+" ("+nick+")<td>"+password;
	}
	buf += "</table>";
	document.getElementById("result").innerHTML = buf;
}

var PasswordGenerator;
(function() {
PasswordGenerator = P;

function P(player_name) {
	this.checksum_name = P.calc_checksum_name(player_name);
}

P.prototype.generate = function(id) {
	var val = P.gen_val(id, this.checksum_name);
	var charcodes = P.val_to_charcodes(val);
	return P.charcodes_to_str(charcodes);
};

P.gen_val = function(id, checksum_name) {
	var foo = 0x00; // 適当な8bitの値（なんでもいい）
	var a = (id & 0xff) << 24 | foo << 16;
	var b = foo << 24 | checksum_name << 8 | (id >> 8);
	a |= P.calc_f4_checksum(a, b);
	var r = P.f3(a, b);
	a = r[0] ^ 0xaec27ff6;
	b = r[1] ^ 0x0c97cec1;
	return [a, b];
};

P.val_to_charcodes = function(val) {
	var m = 0x7f;
	var a = val[0], b = val[1];
	return [
	 a & m,
	 a >>> 7 & m,
	 a >>> 14 & m,
	 a >>> 21 & m,
	 a >>> 28 | (b & 7) << 4,
	 b >>> 3 & m,
	 b >>> 10 & m,
	 b >>> 17 & m
	];
};

P.charcodes_to_str = function(charcodes) {
	var str = "";
	for (var i = 0; i < charcodes.length; i ++) {
		var chr = charcodes[i];
		str += CHAR_TABLE[chr];
	}
	return str;
};

P.f3 = function(a, b) {
	var val = [a, b];
	for (var i = 0; i < 6; i ++) {
		var v = P.byte_get(val, i + 1);
		P.byte_set(val, i + 1, v & ~1 | ((val[0] >> i) & 1));
		val[0] = val[0] & ~(1 << i) | (v & 1) << i;
	}
	return val;
};

P.f4 = function(_a, _b) {
	var a = _a >>> 16 | _b << 16;
	var b = _b >>> 16;
	return [a, b];
};

P.calc_f4_checksum = function(a, b) {
	var r = P.f4(a, b);
	return P.calc_checksum(P.val_to_bytes(r));
};

P.val_to_bytes = function(val) {
	var bytes = [];
	for (var i = 0; i < 5; i ++) {
		bytes[i] = P.byte_get(val, i);
	}
	return bytes;
}

P.byte_get = function(list, pos) {
	return list[pos / 4 | 0] >>> (pos % 4 * 8) & 0xff;
};

P.byte_set = function(list, pos, val) {
	var shift = pos % 4 * 8;
	list[pos / 4 | 0] = list[pos / 4 | 0] & ~(0xff << shift) | ((val & 0xff) << shift);
};



P.calc_checksum_name = function(name) {
	var bytes = P.to_sjis_bytes(name);
	return P.calc_checksum(bytes);
};

P.to_sjis_bytes = function(name) {
	var bytes = [];
	for (var i = 0; i < 8; i ++) {
		var code = 0;
		if (i < name.length) {
			var chr = name.charAt(i);
			code = SJIS_MAP[chr];
		}
		bytes[i*2] = code >> 8;
		bytes[i*2+1] = code & 0xff;
	}
	return bytes;
};

P.calc_checksum = function (bytes) {
	var result = 0xffff;
	for (var i = 0; i < bytes.length; i ++) {
		result ^= bytes[i];
		for (var j = 0; j < 8; j ++) {
			if ((result & 1) != 0) {
				result = 0xfdaa ^ (result >> 1);
			} else {
				result >>= 1;
			}
		}
	}
	return result ^ 0xffff;
};

})();

function gen_chars_map(str) {
	var map = {};
	for (var i = 0; i < str.length; i ++) {
		map[str.charAt(0)] = i;
	}
	return map;
}

function verify_player_name(str) {
	var len = str.length;
	if (!(1 <= len && len <= 8)) {
		return false;
	}
	for (var i = 0; i < len; i ++) {
		var chr = str.charAt(i);
		if (!SJIS_MAP.hasOwnProperty(chr)) {
			return false;
		}
	}
	return true;
}
</script>
<style type="text/css">
table {
	border-collapse: collapse;
}

th,
td {
	padding: 0.1em 5px;
	border: 1px solid black;
}
</style>
</head>
<body>
<h1>イナズマ3 パスワード</h1>
<noscript><p>このツールを利用するにはJavaScriptを有効にする必要があります</p></noscript>
<form action="" name="f" onsubmit="return false;">
<p>プレイヤー名: <input type="text" size="20" name="player_name" value=""> <input type="submit" value="決定">
</form>
<div id="result"></div>
</body>
</html>
